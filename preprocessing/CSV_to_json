import csv
import json

def csv_to_json(csv_file, json_file):
    data = []
    
    # Try different encodings
    encodings = ['utf-8', 'cp1252', 'latin1', 'iso-8859-1']
    
    for encoding in encodings:
        try:
            with open(csv_file, mode='r', encoding=encoding) as file:
                reader = csv.DictReader(file)
                
                for row in reader:
                    text = row['text']  # Assuming the CSV has a column named 'text'
                    label = row['label'].upper()  # Assuming the CSV has a 'label' column
                    
                    # Create categories dict with one-hot encoding
                    cats = {"POSITIVE": 0.0, "NEGATIVE": 0.0}
                    if label in cats:
                        cats[label] = 1.0
                    
                    data.append({"text": text, "cats": cats})
            
            # If we get here, the encoding worked
            print(f"Successfully read the CSV file using {encoding} encoding")
            break
        except UnicodeDecodeError:
            if encoding == encodings[-1]:
                raise Exception("Failed to read the CSV file with all attempted encodings")
            continue
    
    # Write JSON data to a file
    with open(json_file, mode='w', encoding='utf-8') as file:
        json.dump(data, file, indent=4)

    print(f"Data successfully written to {json_file}")

# Example usage
try:
    csv_to_json("input.csv", "output.json")
except Exception as e:
    print(f"Error: {e}")
